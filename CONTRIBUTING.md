# Contributing to Saluki

First of all, thanks for contributing!

This document provides some basic guidelines for contributing to this repository. To propose improvements, feel free to submit a PR.

* [Submitting Issues](#submitting-issues)
* [Pull Requests](#pull-requests)
	- [Keep it small, focused](#keep-it-small-focused)
	- [Commit Messages](#commit-messages)
	- [Pull request workflow](#pull-request-workflow)
    + [Before the first PR review](#before-the-first-pr-review)
    + [After the first review](#after-the-first-review)
    + [How to merge to `main`](#how-to-merge-to-main)

## Submitting Issues

Please feel free to submit an issue if you believe you've discovered a bug.

Make sure to pay attention to the issue template, filling out all sections to provide a sufficient amount of detail to
allow us to verify your report and, hopefully, reproduce it.

## Pull Requests

Have you fixed a bug or written a new piece of helper code? Many thanks!

In order to ease/speed up our review, here are some items you can check/improve when submitting your PR:

<details open>
<summary>Contributor Checklist</summary>

- [ ] Have a proper commit history (we advise you to rebase if needed) with clear commit messages.

- [ ] Write tests for the code you wrote.

- [ ] Preferably make sure that all tests pass locally.

- [ ] Summarize your PR with an explanatory title and a message describing your changes, cross-referencing any related bugs/PRs.

- [ ] Open your PR against the `main` branch.

- [ ] Provide adequate QA/testing plan information.

</details>
<br>

<details>
<summary open>Reviewer Checklist</summary>

- [ ] The added code comes with tests.

- [ ] The CI is green, all tests are passing (required or not).

</details>
<br>

Your pull request must pass all CI tests before we will merge it. If you're seeing an error and don't think it's your
fault, it may not be! Don't hesitate to comment on the PR and we'll work together to fix it.

### Keep it small, focused

Avoid changing too many things at once.

For example, if you're working on changes to a component that requires adding new functionality to core types
(topology builder, event model, etc), then you should split up your changes into multiple PRs, focusing first on the
supporting changes and then the final change that makes the component utilize the new functionality.

### Commit Messages

Please don't be this person: `git commit -m "Fixed stuff"`. Take a moment to write meaningful commit messages.

The commit message should describe the reason for the change and give extra details that will allow someone later on to
understand in 5 seconds the thing you've been working on for a day.

This includes editing the commit message generated by Github from:

```
Including new features

* Fix linter
* WIP
* Add test for x86
* Fix licenses
* Cleanup headers
```

to:

```
Including new features

This feature does this and that. Some tests are excluded on x86 because of ...
```

### Pull request workflow

The goals ordered by priority are:

- Make PR reviews (both initial and follow-up reviews) easy for reviewers using GitHub
- On the `main` branch, have a meaningful commit history that allows understanding (even years later) what each commit
  does, and why.

You must open the PR when the code is reviewable or you must set the PR as draft if you want to share code before it's
ready for actual reviews.

#### Before the first PR review

Before the first PR review, meaningful commits are best: logically-encapsulated commits help the reviews go quicker and
make the job for the reviewer easier. Conflicts with `main` can be resolved with a `git rebase origin/main` and a force
push if it makes future review(s) easier.

#### After the first review

After the first review, to make follow-up reviews easier:

- Avoid force pushes: rewriting the history that was already reviewed makes follow-up reviews painful as GitHub loses
  track of each comment. Instead, address reviews with additional commits on the PR branch.
- Resolve merge conflicts with `main` using `git merge origin/main`

#### How to merge to `main`

Once reviews are complete, the merge to `main` should be done with either:

- the **squash-merge** option, to keep the history of `main` clean (even though some context/details are lost in the
  squash). The commit message for this squash should always be edited to concisely describe the commit without
  extraneous "address review comments" text.
- the **rebase-merge** option, after manually rewriting the PRâ€™s commit history and force-pushing to the branch. When using this option, the branch must have a clean history.
