optimization_goal: memory
erratic: false

target:
  name: agent-data-plane
  command: /usr/local/bin/agent-data-plane --config /etc/agent-data-plane/empty.yaml run
  cpu_allotment: 4
  memory_allotment: 2GiB

  environment:
    # Dummy, self-signed certificate since we're not running alongside the Datadog Agent which
    # would otherwise be providing the IPC certificate.
    DD_IPC_CERT_FILE_PATH: /etc/agent-data-plane/cert.pem

    # Emit logs in JSON so we get better parsing/search over them in the SMP target logs index.
    DD_LOG_FORMAT_JSON: "true"

    DD_API_KEY: a0000001
    DD_HOSTNAME: smp-regression
    DD_DD_URL: http://127.0.0.1:9091

    DD_AGGREGATE_CONTEXT_LIMIT: "3100"

    # Disables UDP and enables listening on UDS in SOCK_DGRAM mode.
    DD_DOGSTATSD_PORT: "0"
    DD_DOGSTATSD_SOCKET: /tmp/adp-dogstatsd-dgram.sock

    # Runs ADP in standalone mode, which decouples ADP from any dependency on the Datadog Agent.
    DD_DATA_PLANE_STANDALONE_MODE: "true"

    # Enable internal telemetry endpoint.
    DD_DATA_PLANE_TELEMETRY_ENABLED: "true"
    DD_DATA_PLANE_TELEMETRY_LISTEN_ADDR: tcp://127.0.0.1:5102

    # Enable OTLP.
    DD_ADP_OTLP_ENABLED: "true"
    DD_OTLP_CONFIG: "{}"
    DD_OTLP_CACHED_CONTEXT_LIMIT: "3100"
