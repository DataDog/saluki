<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Releasing ADP | VitePress</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.DFTx90Kk.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CwDTFhKh.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.AwZz1IS3.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BHrE6nLq.js">
    <link rel="modulepreload" href="/assets/agent-data-plane_releasing.md.BbGOg4Z0.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>VitePress</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _agent-data-plane_releasing" data-v-39a288b8><div><h1 id="releasing-adp" tabindex="-1">Releasing ADP <a class="header-anchor" href="#releasing-adp" aria-label="Permalink to &quot;Releasing ADP&quot;">​</a></h1><p>This page covers the overall release process for Agent Data Plane, including the steps required to create a new release, as well as the technical details around how we determine the version of the release, what metadata is collected/generated, and more.</p><h2 id="high-level-overview" tabindex="-1">High-level overview <a class="header-anchor" href="#high-level-overview" aria-label="Permalink to &quot;High-level overview&quot;">​</a></h2><p>The release process for ADP roughly looks like this:</p><ul><li>create a Github release, which tags <code>main</code> at a particular point</li><li>creation of the Git tag triggers a CI pipeline that additionally unlocks jobs to publish release artifacts</li><li>the additional CI jobs, once manually triggered, will publish ADP container images to various public container image registries</li></ul><h2 id="quick-steps" tabindex="-1">Quick steps <a class="header-anchor" href="#quick-steps" aria-label="Permalink to &quot;Quick steps&quot;">​</a></h2><ul><li>Ensure that <code>main</code> is up-to-date with all of the intended changes that should be present, and that CI tests are passing cleanly (this will get checked in the actual release CI pipeline, but easier to catch problems early)</li><li>Go to the <a href="https://github.com/DataDog/saluki/releases" target="_blank" rel="noreferrer">Releases</a> page on Github and click the <code>Draft a new release</code> button.</li><li>Fill in the appropriate version tag (see <a href="#determining-the-version">&quot;Determining the version&quot;</a> below) and click <code>Create new tag ... on publish</code>.</li><li>Leave <code>Previous tag</code> at <code>auto</code>, and change <code>Release title</code> to <code>Agent Data Plane &lt;version&gt;</code>, where <code>&lt;version&gt;</code> is the new version. (i.e., <code>Agent Data Plane 0.2.0</code>)</li><li>Click the <code>Generate release notes</code> to automatically populate the relevant changes since the last release.</li><li>If there are any additional notes that should be included, add a new section, called <code>Additional Notes</code>, at the top of the release notes (above the auto-generated <code>What&#39;s Changed</code> section)</li><li>Click <code>Publish release</code></li><li>Go to the <a href="https://gitlab.ddbuild.io/DataDog/saluki/-/pipelines" target="_blank" rel="noreferrer">Gitlab CI pipelines dashboard</a> for the repository and find the pipeline that was triggered for the newly-created Git tag. It may take a minute or two for the repository sync and pipeline creation to occur.</li><li>The pipeline should progress through the <code>test</code>, <code>build</code>, <code>correctness</code>, <code>benchmark</code>, and <code>release</code> stages without issue.</li><li>Once all stages have completed, the <code>release</code> stage will have two blocked jobs: <code>publish-bundled-agent-adp-image</code> and <code>publish-bundled-agent-adp-image-jmx</code>. These jobs perform the actual publishing of the container images to our public container image registries, and must be manually triggered.</li><li>Once triggered, they should run to completion.</li><li>Once complete, you should be able to navigate to a public container image registry that we use, such as <a href="https://hub.docker.com/r/datadog/agent/tags" target="_blank" rel="noreferrer">Docker Hub</a>, and find the resulting images: if the tag was <code>0.2.0</code>, you should be able to see a recently-published image with a tag that looks like <code>&lt;Agent version&gt;-v0.2.0-adp-beta-jmx</code>. (See &quot;Determining the version&quot; below for more information on the container image tag format.)</li></ul><h2 id="determining-the-version" tabindex="-1">Determining the version <a class="header-anchor" href="#determining-the-version" aria-label="Permalink to &quot;Determining the version&quot;">​</a></h2><p>For ADP, we determine the version of the release solely from the Git tag that is created, which also drives the CI pipeline used to publish the resulting container images. We <em>do not</em> use the <code>version</code> field of the <code>agent-data-plane</code> crate itself.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>The Git tag <strong>must</strong> be in the format of <code>vX.Y.Z</code>.</p></div><p>When deciding what version to use, we follow the <a href="https://semver.org/" target="_blank" rel="noreferrer">Semantic Versioning</a> specification. This means, in a nutshell:</p><ul><li>prior to v1.0.0: <ul><li>breaking changes are indicated by incrementing the minor version</li><li>new features and bug fixes are generally indicated by incrementing the patch version</li><li>if there are enough new features/bug fixes, we may instead opt to increment the minor version just for simplicity</li></ul></li><li>after v1.0.0: <ul><li>breaking changes are indicated by incrementing the major version (this should generally never happen after v1)</li><li>new features are indicated by incrementing the minor version</li><li>bug fixes are indicated by incrementing the patch version</li></ul></li></ul><p>Additionally, for the container images we build, there is an additional component in the image tag that specifies the version of the Datadog Agent that the image is based on. The Datadog Agent version is controlled in <code>.gitlab-ci.yml</code>, via the <code>BASE_DD_AGENT_VERSION</code> variable. We pull the Datadog Agent image from a public container image registry (Google Container Registry) and layer on the ADP binary, and supporting files, which results in our final &quot;bundled&quot; ADP container image.</p><h2 id="build-metadata" tabindex="-1">Build metadata <a class="header-anchor" href="#build-metadata" aria-label="Permalink to &quot;Build metadata&quot;">​</a></h2><p>We calculate a number of values that are used to populate what we call &quot;build metadata&quot;, which is information passed in during the build process and is used to drive a number of behaviors:</p><ul><li>outputting the version of ADP, when it was built, the build architecture, etc, as a log at startup</li><li>special constant identifiers that are used to populate things like HTTP request headers (user agent, etc)</li></ul><p>This build metadata is <em>normally</em> calculated with a Make target — <code>emit-build-metadata</code> — which populates it during local builds or regular CI builds. However, for release builds, it is set manually when invoking the container image builds. These settings can be found in the <code>.gitlab/release.yml</code> file, under the <code>build-release-adp-image</code> job.</p><p>The relevant build arguments are all prefixed with <code>APP_</code> and are as follows:</p><ul><li><code>APP_FULL_NAME</code>: the full name of the application (hard-coded to <code>agent-data-plane</code>)</li><li><code>APP_SHORT_NAME</code>: the short name of the application (hard-coded to <code>data-plane</code>)</li><li><code>APP_IDENTIFIER</code>: a short identifier for the application (hard-coded to <code>adp</code>)</li><li><code>APP_VERSION</code>: the version of the application (set to the Git tag)</li><li><code>APP_BUILD_DATE</code>: the date the build was performed (set to the creation time of the Gitlab CI pipeline)</li></ul><p>This build metadata should not need to be manually changed on a per-release basis, and so this section is mostly informational and not relevant to the release process itself.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"agent-data-plane_index.md\":\"HwX5OLC4\",\"agent-data-plane_releasing.md\":\"BbGOg4Z0\",\"development_common-language.md\":\"B20rdNGY\",\"development_contributing.md\":\"IMVC-AmP\",\"development_index.md\":\"456uU2w6\",\"development_style-guide.md\":\"B0YR8GOZ\",\"index.md\":\"C5eO-jmW\",\"reference_architecture_index.md\":\"CzGWuU3i\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VitePress\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>